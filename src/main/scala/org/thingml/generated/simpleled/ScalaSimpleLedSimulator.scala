/**
 * File generated by the ThingML IDE
 * /!\Do not edit this file/!\
 * In case of a bug in the generated code,
 * please submit an issue on our GitHub
 **/

package org.thingml.generated.simpleled
import org.sintef.smac._
import org.thingml.devices._
object TestFailure{ def getName = "testFailure" }
case class TestFailure(override val name : String = TestFailure.getName) extends Event(name)
object TestIn{ def getName = "testIn" }
case class TestIn(c : Char, override val name : String = TestIn.getName) extends Event(name)
object Poll{ def getName = "poll" }
case class Poll(override val name : String = Poll.getName) extends Event(name)
object Timer_cancel{ def getName = "timer_cancel" }
case class Timer_cancel(override val name : String = Timer_cancel.getName) extends Event(name)
object TestOut{ def getName = "testOut" }
case class TestOut(c : Char, override val name : String = TestOut.getName) extends Event(name)
object Led_off{ def getName = "led_off" }
case class Led_off(override val name : String = Led_off.getName) extends Event(name)
object Timer_timeout{ def getName = "timer_timeout" }
case class Timer_timeout(override val name : String = Timer_timeout.getName) extends Event(name)
object Led_on{ def getName = "led_on" }
case class Led_on(override val name : String = Led_on.getName) extends Event(name)
object Led_toggle{ def getName = "led_toggle" }
case class Led_toggle(override val name : String = Led_toggle.getName) extends Event(name)
object Timer_start{ def getName = "timer_start" }
case class Timer_start(delay : Int, override val name : String = Timer_start.getName) extends Event(name)

/**
 * Definitions for type : SimpleLed
 **/
class SimpleLed extends Component {

//Companion object
  object SimpleLed{
    object LedPort{
      def getName = "Led"
      object in {
      }
      object out {
        val led_toggle = Led_toggle.getName
      }
    }

    object TimerPort{
      def getName = "Timer"
      object in {
        val timer_timeout = Timer_timeout.getName
      }
      object out {
        val timer_start = Timer_start.getName
      }
    }

  }


// Variables for the properties of the instance
  var SimpleLed_frequency_var : Int = 1000
  new Port(SimpleLed.LedPort.getName, List(), List(SimpleLed.LedPort.out.led_toggle), this).start
  new Port(SimpleLed.TimerPort.getName, List(SimpleLed.TimerPort.in.timer_timeout), List(SimpleLed.TimerPort.out.timer_start), this).start
  this.behavior ++= List(new SimpleLedImplStateMachine(false, this).getBehavior)
  case class SimpleLedImplStateMachine(keepHistory : Boolean, root : Component) extends StateAction {
    def getBehavior = parent
    val parent : StateMachine = new StateMachine(this, keepHistory, root)
    override def onEntry() = {
//No entry action defined for this state
    }

    override def onExit() = {
//No exit action defined for this state
    }

//create sub-states
    val Running_state = new State(RunningState(), root)
    parent.addSubState(Running_state)
    case class RunningState extends StateAction {
      override def onEntry() = {
        handler.getPort("Timer") match{
          case Some(p) => p.send(new Timer_start(SimpleLed_frequency_var))
          case None => println("Warning: no port Timer You may consider revising your ThingML model.")
        }
      }

      override def onExit() = {
//No exit action defined for this state
      }

    }

    parent.setInitial(Running_state)

//create transitions among sub-states
    val t_Running2Running_663362811 = new Transition(Running_state, Running_state, TransitionRunning2Running_663362811(), List((SimpleLed.TimerPort.getName, SimpleLed.TimerPort.in.timer_timeout)))
    parent.addTransition(t_Running2Running_663362811)
    case class TransitionRunning2Running_663362811 extends TransitionAction {
      override def executeActions() = {
        handler.getPort("Led") match{
          case Some(p) => p.send(new Led_toggle())
          case None => println("Warning: no port Led You may consider revising your ThingML model.")
        }
      }

    }
  }
}

/**
 * Definitions for type : Led
 **/
class Led extends Component {

//Companion object
  object Led{
    object LedPort{
      def getName = "Led"
      object in {
        val led_on = Led_on.getName
        val led_off = Led_off.getName
        val led_toggle = Led_toggle.getName
      }
      object out {
      }
    }

  }


// Variables for the properties of the instance
  var Led_device_var : org.thingml.devices.LedDemo = new org.thingml.devices.LedDemo()
  new Port(Led.LedPort.getName, List(Led.LedPort.in.led_on, Led.LedPort.in.led_off, Led.LedPort.in.led_toggle), List(), this).start
  this.behavior ++= List(new LedImplStateMachine(false, this).getBehavior)
  case class LedImplStateMachine(keepHistory : Boolean, root : Component) extends StateAction {
    def getBehavior = parent
    val parent : StateMachine = new StateMachine(this, keepHistory, root)
    override def onEntry() = {
//No entry action defined for this state
    }

    override def onExit() = {
//No exit action defined for this state
    }

//create sub-states
    val LedOff_state = new State(LedOffState(), root)
    parent.addSubState(LedOff_state)
    case class LedOffState extends StateAction {
      override def onEntry() = {
        Led_device_var.off()
      }

      override def onExit() = {
//No exit action defined for this state
      }

    }

    val LedOn_state = new State(LedOnState(), root)
    parent.addSubState(LedOn_state)
    case class LedOnState extends StateAction {
      override def onEntry() = {
        Led_device_var.on()
      }

      override def onExit() = {
//No exit action defined for this state
      }

    }

    parent.setInitial(LedOff_state)

//create transitions among sub-states
    val t_LedOff2LedOn_461870700 = new Transition(LedOff_state, LedOn_state, TransitionLedOff2LedOn_461870700(), List((Led.LedPort.getName, Led.LedPort.in.led_on), (Led.LedPort.getName, Led.LedPort.in.led_toggle)))
    parent.addTransition(t_LedOff2LedOn_461870700)
    val t_LedOn2LedOff_181807138 = new Transition(LedOn_state, LedOff_state, TransitionLedOn2LedOff_181807138(), List((Led.LedPort.getName, Led.LedPort.in.led_off), (Led.LedPort.getName, Led.LedPort.in.led_toggle)))
    parent.addTransition(t_LedOn2LedOff_181807138)
    case class TransitionLedOff2LedOn_461870700 extends TransitionAction {
      override def executeActions() = {
//No action defined for this transition
      }

    }
    case class TransitionLedOn2LedOff_181807138 extends TransitionAction {
      override def executeActions() = {
//No action defined for this transition
      }

    }
  }
}

/**
 * Definitions for type : SoftTimer
 **/
class SoftTimer extends Component with org.thingml.utils.TimerTaskTrait{

//Companion object
  object SoftTimer{
    object PollingPort{
      def getName = "Polling"
      object in {
        val poll = Poll.getName
      }
      object out {
      }
    }

    object timerPort{
      def getName = "timer"
      object in {
        val timer_start = Timer_start.getName
        val timer_cancel = Timer_cancel.getName
      }
      object out {
        val timer_timeout = Timer_timeout.getName
      }
    }

  }


// Variables for the properties of the instance
  var SoftTimer_javaTimer_var : java.util.Timer = new java.util.Timer()
  new Port(SoftTimer.PollingPort.getName, List(SoftTimer.PollingPort.in.poll), List(), this).start
  new Port(SoftTimer.timerPort.getName, List(SoftTimer.timerPort.in.timer_start, SoftTimer.timerPort.in.timer_cancel), List(SoftTimer.timerPort.out.timer_timeout), this).start
  override def run() : Unit = {
    val handler = this
    handler.getPort("timer") match{
      case Some(p) => p.send(new Timer_timeout())
      case None => println("Warning: no port timer You may consider revising your ThingML model.")
    }
  }
  def cancel() : Unit = {
    val handler = this
    try {
    SoftTimer_javaTimer_var.cancel
    SoftTimer_javaTimer_var.purge
    }
    catch {
      case _ =>
    }
  }
  def start(SoftTimer_start_delay_var : Int) : Unit = {
    val handler = this
    SoftTimer_javaTimer_var.schedule(this.newTimerTask, SoftTimer_start_delay_var)
  }
  this.behavior ++= List(new SoftTimerStateMachine(false, this).getBehavior)
  case class SoftTimerStateMachine(keepHistory : Boolean, root : Component) extends StateAction {
    def getBehavior = parent
    val parent : StateMachine = new StateMachine(this, keepHistory, root)
    override def onEntry() = {
//No entry action defined for this state
    }

    override def onExit() = {
//No exit action defined for this state
    }

    val t_self_2131814308 = new InternalTransition(getBehavior, new InternalTransition2131814308(), List((SoftTimer.timerPort.getName, SoftTimer.timerPort.in.timer_start)))
    val t_self_219614127 = new InternalTransition(getBehavior, new InternalTransition219614127(), List((SoftTimer.timerPort.getName, SoftTimer.timerPort.in.timer_cancel)))
    case class InternalTransition2131814308 extends InternalTransitionAction {
      override def checkGuard() : Boolean = {
        try
        getEvent(SoftTimer.timerPort.in.timer_start, SoftTimer.timerPort.getName).get.asInstanceOf[Timer_start].delay > 0
        catch {
          case nse : java.util.NoSuchElementException => return false
          case e : Exception => return false
        }

      }
      override def executeActions() = {
        start(getEvent(SoftTimer.timerPort.in.timer_start, SoftTimer.timerPort.getName).get.asInstanceOf[Timer_start].delay)
      }

    }
    case class InternalTransition219614127 extends InternalTransitionAction {
      override def executeActions() = {
        cancel()
      }

    }
//create sub-states
    val default_state = new State(DefaultState(), root)
    parent.addSubState(default_state)
    case class DefaultState extends StateAction {
      override def onEntry() = {
//No entry action defined for this state
      }

      override def onExit() = {
//No exit action defined for this state
      }

    }

    parent.setInitial(default_state)

//create transitions among sub-states
  }
}